#!/bin/bash

. ${INSTALLER_DIR}/lib/util.sh
. ${INSTALLER_DIR}/lib/util-prepare.sh
. ${INSTALLER_DIR}/lib/util-selectors.sh
. ${INSTALLER_DIR}/lib/util-build.sh


function runOption()
{
  logStart "runOption"
  
  export STACK_ACTION=${1}
  export STACK_PROJECT=${2}
  
  buildProjectPrepare ${STACK_ACTION} ${STACK_PROJECT}

  RUN_FILE=${STACK_INSTALLER_BIN_DIR}/${STACK_ACTION}
  runSource ${RUN_FILE}
  logFinished "runOption"
}

function main()
{
  if selectEnviroment != 1; then
    log "Invalid call selectEnviroment"
  else
    utilPrepareInit
    while :
    do
      cd ${ROOT_DIR}
      export STACK_ACTION=
      export STACK_PROJECT=
      
      selectAction
      if ! [ "$?" -eq 1 ]; then
        log "Invalid selectAction"
        break
      fi

      selectProject;
      if ! [ "$?" -eq 1 ]; then
        log "Invalid selectProject"
        continue;
      fi
      runOption ${STACK_ACTION} ${STACK_PROJECT}
    done
  fi
}

utilInitialize "$@"
main
